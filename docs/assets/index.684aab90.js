import{d as h,r as f,o as v,c as T,a as c,n as R,p as A,b as S,e as m,f as U,g as y,h as b}from"./vendor.1e24eca3.js";const D=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}};D();const P=`
attribute vec4 vertexPos;
attribute vec4 texturePos;
varying vec2 textureCoord;
void main(){
    gl_Position = vertexPos; 
    textureCoord = texturePos.xy;
}
`,L=`
precision highp float;
varying highp vec2 textureCoord;
uniform sampler2D ySampler;
uniform sampler2D uSampler;
uniform sampler2D vSampler;
const mat4 YUV2RGB = mat4(
    1.1643828125, 0, 1.59602734375, -.87078515625,
    1.1643828125, -.39176171875, -.81296875, .52959375,
    1.1643828125, 2.017234375, 0, -1.081390625,
    0, 0, 0, 1
);

void main(void) {
    highp float y = texture2D(ySampler,  textureCoord).r;
    highp float u = texture2D(uSampler,  textureCoord).r;
    highp float v = texture2D(vSampler,  textureCoord).r;
    gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;
}
`;function C(e){const r=e.createShader(e.VERTEX_SHADER);if(!r)return null;e.shaderSource(r,P),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)||console.warn(`Vertex shader failed to compile: ${e.getShaderInfoLog(r)}`);const t=e.createShader(e.FRAGMENT_SHADER);if(!t)return null;e.shaderSource(t,L),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)||console.warn(`Fragment shader failed to compile: ${e.getShaderInfoLog(t)}`);const n=e.createProgram();return n?(e.attachShader(n,r),e.attachShader(n,t),e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS)||console.warn(`Program failed to compile: ${e.getProgramInfoLog(n)}`),e.useProgram(n),n):null}function d(e){const r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),r}function I(e,r){const t=d(e),n=e.getUniformLocation(r,"ySampler");return e.uniform1i(n,0),t}function N(e,r){const t=d(e),n=e.getUniformLocation(r,"uSampler");return e.uniform1i(n,1),t}function w(e,r){const t=d(e),n=e.getUniformLocation(r,"vSampler");return e.uniform1i(n,2),t}function B(e,r){const t=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW);const n=e.getAttribLocation(r,"vertexPos");e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0);const o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);const a=e.getAttribLocation(r,"texturePos");e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0)}const l=["webgl","experimental-webgl","moz-webgl","webkit-3d"];function F(e){let r=null,t=0;for(;!r&&t<l.length;){const n=l[t];try{r=e.getContext(n)}catch{r=null}(!r||typeof r.getParameter!="function")&&(r=null),++t}return r}class X{constructor(r){this.width=0,this.height=0,this.yTexture=null,this.uTexture=null,this.vTexture=null,this.el=r;const t=F(r);if(this.webglContext=t,!t)return;const n=C(t);!n||(B(t,n),this.yTexture=I(t,n),this.uTexture=N(t,n),this.vTexture=w(t,n))}setDimension(r,t){const{el:n}=this;n.width=r,n.height=t,this.width=r,this.height=t}render(r){const t=this.webglContext;if(!t){console.warn("\u672A\u521B\u5EFA webgl");return}const{width:n,height:o}=this;t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.viewport(0,0,n,o);const a=r,s=n*o,u=a.subarray(0,s);t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.yTexture),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,n,o,0,t.LUMINANCE,t.UNSIGNED_BYTE,u);const i=n*o/4,_=a.subarray(s,s+i);t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.uTexture),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,n/2,o/2,0,t.LUMINANCE,t.UNSIGNED_BYTE,_);const x=i,E=a.subarray(s+i,s+i+x);t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,this.vTexture),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,n/2,o/2,0,t.LUMINANCE,t.UNSIGNED_BYTE,E),t.drawArrays(t.TRIANGLE_STRIP,0,4)}clear(){const{webglContext:r}=this;r&&r.clear(r.COLOR_BUFFER_BIT)}dispose(){var t,n,o;this.clear();try{(n=(t=this.webglContext)==null?void 0:t.getExtension("WEBGL_lose_context"))==null||n.loseContext()}catch{}const{el:r}=this;(o=r.parentNode)==null||o.removeChild(r),this.webglContext=null,this.yTexture=null,this.uTexture=null,this.vTexture=null}}var p=(e,r)=>{const t=e.__vccOpts||e;for(const[n,o]of r)t[n]=o;return t};const M=h({name:"YUVRender",setup(e,{expose:r}){let t=null;const n=f(!1),o=f(null);return v(()=>{const a=o.value;!a||(t=new X(a),t.setDimension(768,320))}),r({start(){n.value=!0,fetch("/frame.json").then(a=>a.json()).then(a=>{n.value=!1,t==null||t.render(new Uint8Array(a))})}}),{waiting:n,canvasRef:o}}}),Y=e=>(A("data-v-036d5dd9"),e=e(),S(),e),$={ref:"canvasRef"},V=Y(()=>c("div",{class:"v-loading-spinner"},null,-1));function G(e,r,t,n,o,a){return m(),T("div",{class:R(["yuv-view",{"v-waiting":e.waiting}])},[c("canvas",$,null,512),V],2)}var O=p(M,[["render",G],["__scopeId","data-v-036d5dd9"]]);const g=h({name:"App",components:{YUVRender:O},methods:{start(){this.$refs.yuv.start()}}}),k={class:"viewport"};function W(e,r,t,n,o,a){const s=y("YUVRender");return m(),T("div",k,[U(s,{ref:"yuv"},null,512),c("button",{class:"btn btn-default btn-primary",onClick:r[0]||(r[0]=(...u)=>e.start&&e.start(...u))}," Click here ")])}var K=p(g,[["render",W]]);b(K).mount("#app");
